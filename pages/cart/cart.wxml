<!--pages/cart/cart.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <text class="title">è´­ç‰©è½¦</text>
    <text class="edit-btn" bindtap="onToggleEdit">
      {{editing ? 'å®Œæˆ' : 'ç¼–è¾‘'}}
    </text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºè´­ç‰©è½¦ -->
  <view class="empty-cart" wx:if="{{!loading && cartItems.length === 0}}">
    <text class="empty-icon">ğŸ›’</text>
    <text class="empty-text">è´­ç‰©è½¦æ˜¯ç©ºçš„</text>
    <button class="btn-shopping" bindtap="onContinueShopping">å»è´­ç‰©</button>
  </view>

  <!-- è´­ç‰©è½¦åˆ—è¡¨ -->
  <scroll-view class="cart-list" scroll-y wx:else>
    <view class="cart-items">
      <view 
        class="cart-item" 
        wx:for="{{cartItems}}" 
        wx:key="id"
      >
        <!-- é€‰æ‹©æ¡† -->
        <view 
          class="checkbox {{selectedItems.includes(item.id) ? 'checked' : ''}}"
          data-id="{{item.id}}"
          bindtap="onSelectItem"
        >
          <text class="check-icon">âœ“</text>
        </view>

        <!-- å•†å“å›¾ç‰‡ -->
        <image class="item-image" src="{{item.image}}" mode="aspectFill" />

        <!-- å•†å“ä¿¡æ¯ -->
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-sku" wx:if="{{item.skuName}}">{{item.skuName}}</text>
          <view class="item-price">
            <text class="price">Â¥{{item.price}}</text>
          </view>

          <!-- æ•°é‡æ§åˆ¶ -->
          <view class="quantity-control" wx:if="{{!editing}}">
            <text class="btn-decrease" data-id="{{item.id}}" bindtap="onDecrease">-</text>
            <input 
              class="quantity-input" 
              type="number" 
              value="{{item.quantity}}"
              data-id="{{item.id}}"
              bindinput="onQuantityChange"
            />
            <text class="btn-increase" data-id="{{item.id}}" bindtap="onIncrease">+</text>
          </view>
        </view>

        <!-- ç¼–è¾‘æ¨¡å¼æ“ä½œ -->
        <view class="item-actions" wx:if="{{editing}}">
          <text class="delete-btn" data-id="{{item.id}}" bindtap="onDeleteItem">åˆ é™¤</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨ç»“ç®—æ  -->
  <view class="checkout-bar" wx:if="{{!loading && cartItems.length > 0}}">
    <view class="select-all">
      <view 
        class="checkbox {{allSelected ? 'checked' : ''}}"
        bindtap="onSelectAll"
      >
        <text class="check-icon">âœ“</text>
      </view>
      <text>å…¨é€‰</text>
    </view>

    <view class="total-section">
      <text class="total-label">åˆè®¡:</text>
      <text class="total-price">Â¥{{totalPrice.toFixed(2)}}</text>
    </view>

    <button 
      class="checkout-btn" 
      bindtap="{{editing ? 'onClearCart' : 'onCheckout'}}"
    >
      {{editing ? 'æ¸…ç©ºè´­ç‰©è½¦' : 'å»ç»“ç®—(' + selectedItems.length + ')'}}
    </button>
  </view>
</view>