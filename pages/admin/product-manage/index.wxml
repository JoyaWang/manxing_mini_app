<!--pages/admin/product-manage/index.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="back-button" bindtap="onBack">
      <text class="back-icon">â†</text>
      <text class="back-text">è¿”å›</text>
    </view>
    <text class="title">å•†å“ç®¡ç†</text>
    <button class="add-btn" bindtap="onAddNewProduct">æ·»åŠ å•†å“</button>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="filters">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢å•†å“åç§°" 
        value="{{searchKeyword}}" 
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-icon" bindtap="onSearchConfirm">ğŸ”</text>
    </view>

    <view class="filter-row">
      <picker class="filter-select" value="{{statusFilter}}" bindchange="onStatusChange">
        <view class="filter-label">
          <text>{{statusFilter === 'all' ? 'å…¨éƒ¨çŠ¶æ€' : statusFilter === 'published' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>

      <picker class="filter-select" value="{{selectedCategory}}" bindchange="onCategoryChange">
        <view class="filter-label">
          <text>{{selectedCategory ? selectedCategory : 'å…¨éƒ¨åˆ†ç±»'}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="product-list">
    <block wx:for="{{products}}" wx:key="id">
      <view class="product-card">
        <image class="product-image" src="{{item.mainImage || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+55Sf5rS75Zu+5YOPPC90ZXh0Pjwvc3ZnPg=='}}" />
        
        <view class="product-info">
          <text class="product-name">{{item.name}}</text>
          <text class="product-price">Â¥{{item.price}}</text>
          <text class="product-stock">åº“å­˜: {{item.stock}}</text>
          <text class="product-status {{item.status}}">
            {{item.status === 'published' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}}
          </text>
        </view>

        <view class="product-actions">
          <button class="btn-edit" bindtap="onEditProduct" data-id="{{item.id}}">ç¼–è¾‘</button>
          <button 
            class="btn-status {{item.status === 'published' ? 'btn-unpublish' : 'btn-publish'}}" 
            bindtap="onToggleProductStatus" 
            data-id="{{item.id}}"
          >
            {{item.status === 'published' ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}}
          </button>
          <button class="btn-delete" bindtap="onDeleteProduct" data-id="{{item.id}}">åˆ é™¤</button>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{products.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— å•†å“</text>
      <button class="empty-btn" bindtap="onAddNewProduct">æ·»åŠ ç¬¬ä¸€ä¸ªå•†å“</button>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- åˆ†é¡µ -->
  <view wx:if="{{totalPages > 1}}" class="pagination">
    <button 
      class="page-btn {{currentPage === 1 ? 'disabled' : ''}}" 
      bindtap="onPageChange" 
      data-page="{{currentPage - 1}}"
      disabled="{{currentPage === 1}}"
    >
      ä¸Šä¸€é¡µ
    </button>
    
    <text class="page-info">ç¬¬ {{currentPage}} é¡µ / å…± {{totalPages}} é¡µ</text>
    
    <button 
      class="page-btn {{currentPage === totalPages ? 'disabled' : ''}}" 
      bindtap="onPageChange" 
      data-page="{{currentPage + 1}}"
      disabled="{{currentPage === totalPages}}"
    >
      ä¸‹ä¸€é¡µ
    </button>
  </view>
</view>
